services:
  komodo.mongo:
    image: mongo:8.0.13-noble
    container_name: komodo.mongo
    command: --quiet --wiredTigerCacheSizeGB 0.25
    restart: always
    logging:
      driver: ${COMPOSE_LOGGING_DRIVER:-local}
    networks:
      - komodo
    volumes:
      - /srv/application_data/bootstrap/komodo/mongo/data:/data/db
      - /srv/application_data/bootstrap/komodo/mongo/config:/data/configdb
    env_file:
      - .env
      - secrets.env
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${KOMODO_DB_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${KOMODO_DB_PASSWORD}
    labels:
      komodo.skip: true # Prevent Komodo from stopping with StopAllContainers
      # Glance
      glance.parent: komodo
      glance.name: MongoDB
      glance.category: core
      # What's Up Docker
      wud.watch: true
      wud.watch.digest: false
      wud.link.template: https://www.mongodb.com/docs/manual/release-notes/$${major}.0/#std-label-release-notes-$${major}.0
      wud.display.icon: sh:mongodb
      wud.tag.include: ^\d+\.\d+\.\d+-noble$$
